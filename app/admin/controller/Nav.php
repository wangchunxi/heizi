<?php
    /**
     * Created by PhpStorm.
     * User: Administrator
     * Date: 2017/7/7
     * Time: 10:59
     */
    namespace app\admin\controller;
    use app\admin\model\Menu ;
    use Plug\Plug;

    class  Nav extends  Base{
        private $model;
        private $post;
        public function __construct()
        {
            parent::__construct(); // TODO: Change the autogenerated stub
            /*实例化处理层*/
            $this->model = new Menu();
            $this->post =  input('post.');
        }

        public function index(){
            /*获取配置*/
            $data = $this->Get_sys('index',array());
            /*页面输出*/
            return  $this->Set_ListPage($data['config'],"public/table_list",$data['request_url']);
        }
        public function add(){
            return  $this->info();
        }

        /*导航详情页*/
        public function info(){
            try{
                $data = $this->Get_sys('info');
                return $this->Set_ListPage($data['config'],"public/info",$data['request_url']);
            }catch( \Exception $e){
                $this->error($e->getMessage());
            }
        }

        public function update(){
            if(request()->isPost()){
                try{
                     $result =  $this->model->set_post($this->post)->update_data();
                     return $result;
                    }catch( \Exception $e){
                        return ajax_return(false,$e->getMessage());
                    }
            }
        }

        /**
         * 左侧菜单返回
         * @return mixed
         */
        public function leftnav(){
            if(!session('uid')){
                return false;
            }
            $array =   $this->model->set_menu_ids()->get_Allmenu();
            return       $array;
        }

        public function navlist(){
            return view();
        }

        /**
         * 获取配置参数
         */
        protected  function Get_sys($page_name='',$data=array()){
            $Plug = new Plug();
            switch($page_name){
                case 'index':
                    $data['config'] = $Plug->Set_TabTop(1)->index('Set_User_TabTop');
                    $data['request_url']['get_list'] =  url('getlist');
                    $data['request_url']['add_url'] = url('add');
                    break;
                case 'info':
                    if($data){
                        $data['config'] =$Plug->Set_Value($data)->index('Set_Menu_info');
                    }else{
                        $data['config'] =$Plug->index('Set_Menu_info');
                    }
                    $data['request_url']['submit_url'] = url('update');
                    break;
                case 'getlist':
                    $data['config']= $Plug->index('Set_User_TabBottom');
                    $data['request_url']['edit'] = '/admin/User/info/id/';
                    break;
            }
            return $data;
        }
    }